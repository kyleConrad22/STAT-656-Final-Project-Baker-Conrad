---
title: "Project Report"
author: "Kyle Conrad and Sarah Baker"
date: "11/19/2023"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

### Questions of interest
\begin{itemize}
  \item How is the growth of plants within the Sonoran Desert affected by different fertilization methods and nitrogen atmospheric deposition.
  \item Is there a difference in the impact of these fertilization methods and nitrogen deposition between the three zones studied? These zones are: with the urban core, west of the urban core, and east of the urban core.
  \item Is there a difference apparent between affect on growth of annual plants as compared to perennial plants? What is the impact on growth of Larrea Tridentata plants specifically?
\end{itemize}

Loading the required packages:
```{r}
library(tidyverse) # For re-formatting data sets
library(lubridate) # For manipulations of date columns
```

Read in data:
```{r}
annuals_biomass <- read.csv("Data/632_annuals_biomass.csv")
annuals_composition <- read.csv("Data/632_annuals_composition.csv")
atmospheric_deposition <- read.csv("Data/632_atmospheric_deposition.csv")
fertilizer_application <- read.csv("Data/632_fertilizer_application.csv")
plant_root_simulator <- read.csv("Data/632_plant_root_simulator.csv")
stem_growth <- read.csv("Data/632_stem_growth.csv")
tissue_chn <- read.csv("Data/632_tissue_chn.csv")
tissue_icp <- read.csv("Data/632_tissue_icp.csv")
```

Prior to beginning analysis, the data should be cleaned to remove justifiable outlying observations. Additionally, variables which will not be used will be removed from each sub data set prior to combining data.\

Begin by cleaning up `annuals_biomass` which contains the response variable of interest, biomass. 
Cleaning up annuals_composition:
```{r}
annuals_composition <- subset(annuals_composition, select = -c(date))
  # Removing the date column (it's empty, so we don't need it anyway)

annuals_composition2 <- annuals_composition %>% 
  # Creates a new data set  
  mutate(gp = cumsum(cover_type == 1)) %>% 
    # Creates a new column, gp, from column name
  pivot_wider(names_from = "cover_type", values_from = "cover_amount") %>% 
    # Takes each entry under cover_type and creates a column
      # Then, fills the rows with the corresponding entry from the cover_amount column
  select(-gp)
    # Removes the gp column

annuals_composition2[is.na(annuals_composition2)] = 0
  # Replaces the NAs in the data set with zeros
    # This assumes that anywhere we do not have a recorded amount of cover for a species, that is because it was not present

annuals_composition2 <- subset(annuals_composition2, select = -c(location_within_plot, collector, cover_category, sampled, green, litter, unidentified_1_2018, unidentified_3_2018, unidentified_2_2018, unidentified_1_2019))
  # Removing unnecessary columns

annuals_composition2 <- annuals_composition2 %>%
  # Over-writes data set
  group_by(site_code, plot_id, subplot, treatment_code, year) %>%
    # First, groups by site_code, plot_id, subplot, treatment_code, and year
  summarise_at(vars(Crassula_connata:Matthiola_parviflora), sum)
    # Then, averages mass for each grouping
```

Cleaning up annuals_biomass:
```{r}
annuals_biomass <- subset(annuals_biomass, select = -c(location_within_plot, subplot, subquad_orientation, date, notes))
  # Removing location_within_plot, subplot, subquad_orientation, date, and notes

annuals_biomass <- annuals_biomass %>%
  # Over-writes data set
  group_by(site_code, plot_id, treatment_code, year) %>%
    # First, groups by site_code, plot_id, treatment_code, and year
  summarise(avg_mass = mean(mass))
    # Then, averages mass for each grouping
```

Cleaning up atmospheric_deposition:
```{r}
atmospheric_deposition$year <- year(ymd(atmospheric_deposition$collection_date))
  # Creating a year column 

atmospheric_deposition <- subset(atmospheric_deposition, select = -c(run_id, field_id, collection_date, notes))
  # Removing the run_id, field_id, collection_date and notes columns

atmospheric_deposition <- atmospheric_deposition %>%
  # Over-writes data set
  group_by(site_code, analyte_name, year) %>%
    # First, groups by site_code, analyte_name, and year
  summarise(avg_concentration = mean(concentration))
    # Then, averages concentration for each grouping
```

Cleaning up fertilizer_application:
```{r}
fertilizer_application$year <- year(ymd(fertilizer_application$application_date))
  # Creating a year column 

fertilizer_application <- subset(fertilizer_application, select = -c(application_date))
  # Removing the application_date column

fertilizer_application <- fertilizer_application %>%
  # Over-writes data set
  group_by(site_code, year) %>%
    # First, groups by site_code, and year
  summarise(avg_nitrogen = mean(nitrogen), avg_phosphorus = mean(phosphorus))
    # Then, averages nitrogen and phosphorus for each grouping
```

Cleaning up plant_root_simulator:
```{r}
plant_root_simulator$year <- year(ymd(plant_root_simulator$start_date))
  # Creating a year column 

plant_root_simulator <- subset(plant_root_simulator, select = -c(start_date, end_date, flag, location_within_plot, num_cation_probes, num_anion_probes, notes))
  # Removing the start_date, end_date, flag, location_within_plot, num_cation_probes, and num_anion_probes

plant_root_simulator <- plant_root_simulator %>%
  # Over-writes data set
  group_by(site_code, plot_id, treatment_code, analyte, year) %>%
    # First, groups by site_code, plot_id, treatment_code, analyte,
  summarise(avg_finalValue = mean(final_value))
    # Then, final_value for each grouping
```

Cleaning up stem_growth:
```{r}
stem_growth$year <- year(ymd(stem_growth$post_date))
  # Creating a year column 
    # Using the post_date because measurements made at post_date

stem_growth <- subset(stem_growth, select = -c(shrub_code, direction, pre_date, post_date, post_note, post_measurement, stem_comment, plot_comment))
  # Removing the shrub_code, direction, pre_date, post_date, post_note, post_measurement, stem_comment, and plot_comment columns

stem_growth <- stem_growth %>%
  # Over-writes data set
  group_by(site_code, plot_id, treatment_code, scientific_name, year) %>%
    # First, groups by site_code, plot_id, treatment_code, scientific_name, analyte,
  summarise(avg_stemLength = mean(stem_length))
    # Then, stem_length for each grouping
```

Cleaning up tissue_chn:
```{r}
tissue_chn$year <- year(ymd(tissue_chn$sample_date))
  # Creating a year column 

tissue_chn <- subset(tissue_chn, select = -c(sample_date, season_year, Comment))
  # Removing the sample_date, season_year, and notes columns

tissue_chn <- tissue_chn %>%
  # Over-writes data set
  group_by(site_code, plot_id, treatment_code, tissue_type, analyte, year) %>%
    # First, groups by site_code, plot_id, treatment_code, tissue_type, analyte, and year
  summarise(avg_weight_g = mean(Weight), avg_composition = mean(percent_composition))
    # Then, average weight and percent_composition for each grouping
```

Cleaning up tissue_icp:
```{r}
tissue_icp$year <- year(ymd(tissue_icp$sample_date))
  # Creating a year column 

tissue_icp <- subset(tissue_icp, select = -c(sample_date, season_year, instrument, source_file))
  # Removing the sample_date, season_year, instrument, and source_file columns

tissue_icp <- tissue_icp %>%
  # Over-writes data set
  group_by(site_code, plot_id, treatment_code, tissue_type, isotope_element, year) %>%
    # First, groups by site_code, plot_id, treatment_code, tissue_type, analyte, and year
  summarise(avg_concentration_isotope = mean(concentration))
    # Then, average weight and percent_composition for each grouping
```

Merging data sets:
```{r}
Reduce(intersect, lapply(list(annuals_biomass, annuals_composition2, plant_root_simulator, stem_growth, tissue_chn, tissue_icp), names))
   # These data sets all contain site_code, plot_id, treatment_code, and year

Reduce(intersect, lapply(list(annuals_biomass, atmospheric_deposition, plant_root_simulator, stem_growth, tissue_chn, tissue_icp), names))
  # These data sets all contain site_code and year

# Starting with the data sets that have the most column in common:
  # merging by site_code, plot_id, treatment_code, and year
dataframes <- list(annuals_biomass, annuals_composition2, plant_root_simulator, stem_growth, tissue_chn, tissue_icp)
  # Creating list of data frames

data_comb1 <- dataframes %>% reduce(full_join, by = c("site_code", "plot_id", "treatment_code", "year"))
  # Merging by common columns

# Now merging with the last data set
dataframes <- list(data_comb1, atmospheric_deposition)
  # Creating list of data frames

data_comb_full <- dataframes %>% reduce(full_join, by = c("site_code", "year"))
  # Merging by common columns
```

# Appendix
## Descriptions of Data Sets and Variables
### Annuals_Biomass
Biomass (g) of annual plants harvested from subplots within Desert Fertilization study plots. One-meter subplots include locations around a Larrea tridentata plant and locations in the interplant space between shrubs. Material is harvested from 0.25 square meter quadrants within each subplot. All harvests occur during the spring.
\begin{itemize}
  \item site\_code - site name abbreviation
  \item plot\_id - plot id number
  \item treatment\_code - treatment name abbreviation
  \item location\_within\_plot - habitat within plot where probes were deployed
  \item subplot - subplot number (one of two replicates)
  \item subquad\_orientation - direction of sub-quadrant from which biomass was harvested
  \item date - date of data collection
  \item year - year of data collection
  \item mass - mass of biomass harvested in 0.25 meter Square quadrant
  \item notes - field and processing notes
\end{itemize}

### Annuals_Composition
Composition of annual plants and some other characteristics (e.g., bare soil, base or canopy of perennial plants) at subplots within Desert Fertilization study plots. One-meter subplots include locations around a Larrea tridentata plant and locations in the interplant space between shrubs. All measurements collected in the spring.
\begin{itemize}
  \item site\_code - site name abbreviation
  \item plot\_id - plot id number
  \item treatment\_code - treatment name abbreviation
  \item location\_within\_plot - habitat within plot where probes were deployed
  \item subplot - subplot number (one of two replicates)
  \item date - date of data collection
  \item year - year of data collection
  \item collector - initials of subplot surveyors
  \item cover\_type - taxon of annual plant, plot characteristic, or logistical note
  \item cover\_category - nature of the observation (taxonomic, general plot characteristic, logistical)
  \item cover\_amount - proportion of subplot as a decimal fraction of this type
\end{itemize}

### Atmospheric_Deposition
Ammonium-nitrogen and nitrate-nitrogen as measured by ion exchange resin (IER) collectors that are used to measure bulk (wet) deposition in interplant open spaces and throughfall (wet and dry) deposition under the dominant shrub.
\begin{itemize}
  \item run\_id - unique identifer of Lachat run provided primarily to allow users to associate blanks with samples
  \item field\_id - sample identifer
  \item collection\_date - date collectors are extracted from their deployment in the field
  \item notes - technician notes regarding conditions in the field or sample processing
  \item analyte\_name - nitrogen species measured (ammonium-nitrogen or nitrate-nitrogen)
  \item concentation - concentration of nitrogen species measured as ammonium-nitrogen or nitrate-nitrogen
  \item site\_code - site name abbreviation
\end{itemize}

### Fertilizer_Application
Catalog of amounts and timing of nitrogen and phosphorus fertilizer applications to nitrogen (N), phosphorus (P), and nitrogen+phosphorus (N+P) treatment plots - applications are delivered to the respective plot at the site that receives either N, P, or an N+P addition, except control sites (n = 2) that do not receive a fertilizer amendment.
\begin{itemize}
  \item site\_code - site name abbreviation
  \item application\_date - date of fertilizer application
  \item nitrogen - amount of ammonium-nitrate nitrogen fertilizer applied to 20mx20m nitrogen (N) and nitrogen+phosphorus (N+P) treatment plots
  \item phosphorus - amount of triple-super phosphate phosphorus fertilizer applied to 20mx20m phosphorus (P) and nitrogen+phosphorus (N+P) treatment plots
\end{itemize}

### Plant_Root_Simulator
Soil ion concentrations as determined with Plant Root Simulator (PRS®) probes (ion exchange resin membranes). Probes for the analyses of soil anions have a positively-charged membrane to simultaneously attract and adsorb all negatively-charged anions, such as nitrate (NO3-), phosphate (H2PO4-, HPO42-), and sulphate (SO42-), whereas cation probes have a negatively-charged membrane to simultaneously attract and adsorb all positively-charged cations, such as ammonium (NH4+), potassium (K+), calcium (Ca2+), and magnesium (Mg2+).
\begin{itemize}
  \item site\_code - site name abbreviation
  \item plot\_id - plot id number
  \item treatment\_code - treatment name abbreviation
  \item start\_date - date of probe deployment
  \item end\_date - date of probe extraction
  \item analyte - analyte measured
  \item final\_value - analyte concentration
  \item flag - data quality flag
  \item location\_within\_plot - habitat within plot where probes were deployed
  \item num\_cation\_probes - number of probes designated for analysis of cations recovered (of four)
  \item num\_anion\_probes - number of probes designated for analysis of anions recovered (of four)
  \item notes - notes pertaining to the deployment or analysis of the probes
\end{itemize}

### Stem_Growth
Biannual measures of stem growth on five Larrea tridentata study plants in Desert Fertilization experiment treatment and control plots.
\begin{itemize}
  \item site\_code - site name abbreviation
  \item plot\_id - plot id number
  \item treatment\_code - treatment name abbreviation
  \item scientific\_name - scientific name of plant measured
  \item shrub\_code - study plant identifier
  \item direction - direction or quadrant of plant in which measured stem is positioned
  \item pre\_date - date of initial or pre stem-length measurement
  \item post\_date - date of final or post stem-length
  \item post\_note - field note regarding final or post stem-length measurement
  \item post\_measurement - boolean indicator denoting whether the measurement is a pre or initial stem-length measurement (FALSE), or a final or post stem-length measurement (TRUE)
  \item stem\_length - length of stem
  \item stem\_comment - field note(s) regarding particular shrub or measurement
  \item plot\_comment - field note(s) regarding particular the plot or site
\end{itemize}

### Tissue_Chn
CHN (Carbon, Hydrogen, and Nitrogen) elemental analysis of Larrea tridentata leaf tissue and Pectocarya recurvata (whole plant) tissue collected from control plots at Desert Fertilization study sites.
\begin{itemize}
  \item site\_code - site name abbreviation
  \item plot\_id - plot id number
  \item treatment\_code - treatment name abbreviation
  \item sample\_date - date of leaf (Larrea) or plant (Pectocarya) collection
  \item season\_year - season and year of collection (for easier sorting)
  \item tissue\_type - source of tissue material
  \item analyte - element analyzed
  \item weight - weight of material used for analysis
  \item percent\_compostition - percent composition of analyte
  \item comment - comment about analytical measurement
\end{itemize}

### Tissue_Icp
Elemental composition of Larrea tridentata leaf tissue and Pectocarya recurvata (whole plant) tissue collected from control plots at Desert Fertilization study sites. Most analyses are by ICP-MS except Sulfur (S), which is typically analyzed by ICP-OES with the instrument type noted in the instrument field.
\begin{itemize}
  \item site\_code - site name abbreviation
  \item plot\_id - plot id number
  \item treatment\_code - treatment name abbreviation
  \item sample\_date - date of leaf (Larrea) or plant (Pectocarya) collection
  \item season\_year - season and year of collection (for easier sorting)
  \item tissue\_type - source of tissue material
  \item instrument - instrument employed for tissue analysis
  \item isotope\_element - isotope atomic mass and element symbol, except Sulfur (S; element symbol only)
  \item concentration - mass of isotope\_element per mass of leaf material
  \item source\_file - file name corresponding to raw data for the observation (raw data available as another entity in this data set)
\end{itemize}

## Site Codes
\begin{itemize}
  \item DBG - core region: Desert Botanical Garden
  \item EME - west region: Estrella Mountain Regional Park east
  \item EMW - west region: Estrella Mountain Regional Park west
  \item LDP - east region: Lost Dutchman State Park
  \item MCN - east region: McDowell Mountain Regional north
  \item MCS - east region: McDowell Mountain Regional south
  \item MVP - core region: North Mountain
  \item PWP - core region: Piestewa Peak
  \item SME - core region: South Mountain Park east
  \item SMW - core region: South Mountain Park west
  \item SNE - west region: Sonoran Desert National Monument east
  \item SNW - west region: Sonoran Desert National Monument west
  \item SRR - east region: Salt River Recreation Area (Tonto NF)
  \item UMP - east region: Usery Mountain Regional Park
  \item WTM - west region: White Tanks Mountain Regional Park
\end{itemize} 

## Treatment Codes
\begin{itemize}
  \item C1 - control plot 1
  \item N	- nitrogen amendment
  \item NP - nitrogen + phosphorus amendment
  \item P	- phosphorus amendment
\end{itemize}

## Location Within Plot (Biomass / Composition) Codes
\begin{itemize}
  \item IP - subplot located in an interplant space	
  \item P	- subplot features a Larrea tridentata plant
\end{itemize}

## Cover Category Codes
\begin{itemize}
  \item annual - observation referring to a type of plant
  \item plot\_characteristic - observation referring to characteristic of the plot other than cover of a specific type of annual plant
  \item record\_keeping - entry for record keeping, typically whether the plot was survyed
\end{itemize}

## Location Within Plot (Simulator) Codes
\begin{itemize}
  \item between\_plant - probes buried between plant canopies
  \item blank - field blank: probe stored in a clean container under refrigeration during the deployment period
  \item blk\_washed - field blank (washed): probe stored in a clean container under refrigeration during the deployment period, and washed as per sample probes
  \item under\_plant - probes buried beneath the canopy of Larrea tridentata
\end{itemize}

## Analyte Codes
\begin{itemize}
  \item Al - aluminum	
  \item B	- boron	
  \item Ca - calcium	
  \item Cd - cadmium	
  \item Cu - copper	
  \item Fe - iron	
  \item K	- potassium	
  \item Mg - magnesium	
  \item Mn - manganese	
  \item NH4-N	- ammonium-nitrogen	
  \item NO3-N	- nitrate-nitrogen	
  \item P	- phosphorus	
  \item Pb - lead	
  \item S	- sulfur	
  \item Total-N	- sum of NO3-N and NH4-N	
  \item Zn - zinc
\end{itemize}

## Shrub Codes
\begin{itemize}
  \item L1 - Larrea tridentata study plant \#1	
  \item L2 - Larrea tridentata study plant \#2	
  \item L3 - Larrea tridentata study plant \#3	
  \item L4 - Larrea tridentata study plant \#4	
  \item L5 - Larrea tridentata study plant \#5
\end{itemize}

## Tissue Type Codes
\begin{itemize}
  \item Larrea tridentata - Larrea tridentata leaf tissue	
  \item Pectocarya recurvata - Pectocarya recurvata whole-plant tissue	
\end{itemize}

## Analyte (Tissue_chn) Codes
\begin{itemize}
  \item Carbon \% - percent carbon	
  \item Hydrogen \% - percent hydrogen	
  \item Nitrogen \% - percent nitrogen
\end{itemize}

## Instrument Codes
\begin{itemize}
  \item ICP-MS - Inductively Coupled Plasma Mass Spectrometer	
  \item ICP-OES - Inductively Coupled Plasma Optical Emission Spectrometer
\end{itemize}